 ---
title: "Movielens Project"
author: "Derrick Owusu Ofori"
date: "11/01/2021"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
---



# Introduction

Recommendation system is a class of machine learning algorithim that offers useful and relevant suggestions to users. Recommendation systems has applications in several fields but for this project we would focus on creating a movie recommender system. We will employ the MovieLens 10M dataset complied by the Grouplens Research lab found here; https://grouplens.org/datasets/movielens/10m/ and http://files.grouplens.org/datasets/movielens/ml-10m.zip. This dataset contains roughly ten million obervations and six variables namely; userId, movieId, rating, timestamp, title and genres. 

The aim of this project is to utilize a subset of the dataset to build an algorithim that can make predictions about user ratings in a validation set. In order to evaluate the performance of the algorthim we will utilise Root Mean Square Error (RMSE). The RMSE is the square root of the mean of the square of all the error. It can be calculated by squaring the residuals,finding the average of the residuals and taking the square root of the result. It basically measures the difference between the predicted and actual values, with a lower RMSE value being better than a higher value.

$$ RMSE = \sqrt{\frac{1}{N}\displaystyle\sum_{u,i} (\hat{y}_{u,i}-y_{u,i})^{2}} $$

To achieve the aim of this project we will first import the data, perform some exploratory data analysis and finally compare four  models to determine the best RMSE for the movie rating prediction.

# Methods

## Installing packages and Importing data

```{r, message=FALSE}
#Load Packages and libraries
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(caret)) install.packages("caret", repos = "http://cran.us.r-project.org")
if(!require(data.table)) install.packages("data.table", repos = "http://cran.us.r-project.org")
if(!require(recosystem)) install.packages("recosystem", repos = "http://cran.us.r-project.org")


library(tidyverse)
library(caret)
library(data.table)
library(recosystem)
```
MovieLens 10M dataset:
https://grouplens.org/datasets/movielens/10m/
http://files.grouplens.org/datasets/movielens/ml-10m.zip

```{r}
dl <- tempfile()
download.file("http://files.grouplens.org/datasets/movielens/ml-10m.zip", dl)

ratings <- fread(text = gsub("::", "\t", readLines(unzip(dl, "ml-10M100K/ratings.dat"))),
                 col.names = c("userId", "movieId", "rating", "timestamp"))

movies <- str_split_fixed(readLines(unzip(dl, "ml-10M100K/movies.dat")), "\\::", 3)
colnames(movies) <- c("movieId", "title", "genres")

# if using R 3.6 or earlier:
movies <- as.data.frame(movies) %>% mutate(movieId = as.numeric(levels(movieId))[movieId],
                                           title = as.character(title),
                                           genres = as.character(genres))
# if using R 4.0 or later:
movies <- as.data.frame(movies) %>% mutate(movieId = as.numeric(movieId),
                                           title = as.character(title),
                                           genres = as.character(genres))


movielens <- left_join(ratings, movies, by = "movieId")
```

The dataset will now be split into a train set (edx) which we will use to train, develop and select our algorithim and a test set (validation) to test the performance of the final algorithm. The test set will be 10% of the dataset.


```{r}
# Validation set will be 10% of MovieLens data
set.seed(1, sample.kind="Rounding") # if using R 3.5 or earlier, use `set.seed(1)`
test_index <- createDataPartition(y = movielens$rating, times = 1, p = 0.1, list = FALSE)
edx <- movielens[-test_index,]
temp <- movielens[test_index,]

# Make sure userId and movieId in validation set are also in edx set
validation <- temp %>% 
  semi_join(edx, by = "movieId") %>%
  semi_join(edx, by = "userId")

# Add rows removed from validation set back into edx set
removed <- anti_join(temp, validation)
edx <- rbind(edx, removed)

rm(dl, ratings, movies, test_index, temp, movielens, removed)

```
## Data exploration and visualization

###Number of rating per movie

Certian movies were rated a few times and hence emphasis would not be placed on them in the predictive algorithim
```{r, message= FALSE}
edx %>%
  count(movieId) %>%
  ggplot(aes(n)) +
  geom_histogram(bins = 25, color = "black", fill="green") +
  scale_x_log10() + xlab("Number of ratings") +
  ylab("Number of movies") + ggtitle("Number of ratings per movie")
```

### Number of rating per user
Some users tend to rate very few movies whiles others may rate a lot more movies. There is therefore a disparity in how active users are.

```{r, message= FALSE}
edx %>%
  count(userId) %>%
  ggplot(aes(n)) + geom_histogram(bins = 25, color = "black",fill="green") +
  scale_x_log10() +
  xlab("Number of ratings") + ylab("Number of users") +
  ggtitle("Number of ratings given by users")
  ```

## Modeling approach
